<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGI Explorer - Test Suite</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .test-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 1000;
            max-width: 350px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .test-panel h2 {
            margin-top: 0;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .test-log {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .test-log-entry {
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        .test-log-entry.success {
            color: #10b981;
        }
        
        .test-log-entry.error {
            color: #ef4444;
        }
        
        .test-log-entry.info {
            color: #6366f1;
        }
        
        .test-summary {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 4px;
        }
        
        .test-summary h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .test-summary ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .test-summary li {
            margin-bottom: 5px;
        }
        
        .test-summary .passed {
            color: #10b981;
        }
        
        .test-summary .failed {
            color: #ef4444;
        }
    </style>
</head>
<body>
    <!-- Include the original index.html content -->
    <iframe src="index.html" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
    
    <!-- Test Panel -->
    <div class="test-panel">
        <h2>AGI Explorer Test Suite</h2>
        
        <div class="test-controls">
            <button id="runAllTests" class="primary-button">Run All Tests</button>
            <button id="clearLog" class="secondary-button">Clear Log</button>
        </div>
        
        <div class="test-log" id="testLog">
            <div class="test-log-entry info">Test suite initialized. Click "Run All Tests" to begin testing.</div>
        </div>
        
        <div class="test-summary" id="testSummary">
            <h3>Test Summary</h3>
            <p>No tests have been run yet.</p>
        </div>
    </div>
    
    <script>
        // Test suite functionality
        document.addEventListener('DOMContentLoaded', function() {
            const iframe = document.querySelector('iframe');
            const runAllTestsBtn = document.getElementById('runAllTests');
            const clearLogBtn = document.getElementById('clearLog');
            const testLog = document.getElementById('testLog');
            const testSummary = document.getElementById('testSummary');
            
            // Log function
            function log(message, type = 'info') {
                const entry = document.createElement('div');
                entry.className = `test-log-entry ${type}`;
                entry.textContent = message;
                testLog.appendChild(entry);
                testLog.scrollTop = testLog.scrollHeight;
            }
            
            // Clear log
            clearLogBtn.addEventListener('click', function() {
                testLog.innerHTML = '';
                log('Log cleared.', 'info');
            });
            
            // Run all tests
            runAllTestsBtn.addEventListener('click', function() {
                log('Running all tests...', 'info');
                
                // Wait for iframe to load
                if (iframe.contentDocument.readyState === 'complete') {
                    runTests();
                } else {
                    log('Waiting for page to load...', 'info');
                    iframe.addEventListener('load', runTests);
                }
            });
            
            function runTests() {
                try {
                    // Access the iframe content
                    const iframeWindow = iframe.contentWindow;
                    const iframeDocument = iframe.contentDocument;
                    
                    // Test 1: Check if brain visualization exists
                    log('Test 1: Brain Visualization', 'info');
                    const brainContainer = iframeDocument.getElementById('brainVisualization');
                    if (!brainContainer) {
                        log('Brain visualization container not found!', 'error');
                        return;
                    }
                    
                    const neurons = brainContainer.querySelectorAll('.neuron');
                    const connections = brainContainer.querySelectorAll('.connection');
                    
                    if (neurons.length === 0) {
                        log('No neurons found in brain visualization!', 'error');
                    } else {
                        log(`Found ${neurons.length} neurons in brain visualization.`, 'success');
                    }
                    
                    if (connections.length === 0) {
                        log('No connections found in brain visualization!', 'error');
                    } else {
                        log(`Found ${connections.length} connections in brain visualization.`, 'success');
                    }
                    
                    // Test 2: Check navigation links
                    log('Test 2: Navigation Links', 'info');
                    const navLinks = iframeDocument.querySelectorAll('.nav-links a');
                    if (navLinks.length === 0) {
                        log('No navigation links found!', 'error');
                    } else {
                        log(`Found ${navLinks.length} navigation links.`, 'success');
                        
                        // Check if links point to valid sections
                        let validLinks = 0;
                        navLinks.forEach(link => {
                            const href = link.getAttribute('href');
                            if (href && href.startsWith('#') && iframeDocument.querySelector(href)) {
                                validLinks++;
                            }
                        });
                        
                        log(`${validLinks} of ${navLinks.length} links point to valid sections.`, validLinks === navLinks.length ? 'success' : 'error');
                    }
                    
                    // Test 3: Check simulation controls
                    log('Test 3: Simulation Controls', 'info');
                    const controls = [
                        'learningRate',
                        'networkSize',
                        'taskComplexity',
                        'taskDomain',
                        'runSimulation',
                        'resetSimulation'
                    ];
                    
                    let missingControls = [];
                    controls.forEach(controlId => {
                        if (!iframeDocument.getElementById(controlId)) {
                            missingControls.push(controlId);
                        }
                    });
                    
                    if (missingControls.length > 0) {
                        log(`Missing simulation controls: ${missingControls.join(', ')}`, 'error');
                    } else {
                        log('All simulation controls found.', 'success');
                    }
                    
                    // Test 4: Check popup functionality
                    log('Test 4: Popup Functionality', 'info');
                    const simulateBtn = iframeDocument.getElementById('simulateBtn');
                    const simulationPopup = iframeDocument.getElementById('simulationPopup');
                    const closePopup = iframeDocument.getElementById('closePopup');
                    
                    if (!simulateBtn || !simulationPopup || !closePopup) {
                        log('Popup elements not found!', 'error');
                    } else {
                        log('All popup elements found.', 'success');
                        
                        // Test opening popup
                        simulateBtn.click();
                        setTimeout(() => {
                            const isDisplayed = window.getComputedStyle(simulationPopup).display === 'flex';
                            log(`Popup ${isDisplayed ? 'opened' : 'failed to open'} when button clicked.`, isDisplayed ? 'success' : 'error');
                            
                            // Test closing popup
                            closePopup.click();
                            setTimeout(() => {
                                const isClosed = window.getComputedStyle(simulationPopup).display === 'none';
                                log(`Popup ${isClosed ? 'closed' : 'failed to close'} when close button clicked.`, isClosed ? 'success' : 'error');
                                
                                // Update test summary
                                updateTestSummary();
                            }, 300);
                        }, 300);
                    }
                    
                } catch (error) {
                    log(`Error running tests: ${error.message}`, 'error');
                    console.error(error);
                }
            }
            
            function updateTestSummary() {
                // Count success and error messages
                const successCount = testLog.querySelectorAll('.test-log-entry.success').length;
                const errorCount = testLog.querySelectorAll('.test-log-entry.error').length;
                const totalTests = 4; // Number of test categories
                
                // Create summary HTML
                let summaryHTML = `<h3>Test Summary</h3>`;
                
                if (successCount + errorCount === 0) {
                    summaryHTML += `<p>No test results available.</p>`;
                } else {
                    const passedTests = errorCount === 0 ? totalTests : totalTests - 1;
                    summaryHTML += `
                        <p>${passedTests} of ${totalTests} tests passed.</p>
                        <ul>
                            <li class="${errorCount === 0 ? 'passed' : 'failed'}">Brain Visualization: ${errorCount === 0 ? 'PASSED' : 'FAILED'}</li>
                            <li class="${errorCount === 0 ? 'passed' : 'failed'}">Navigation Links: ${errorCount === 0 ? 'PASSED' : 'FAILED'}</li>
                            <li class="${errorCount === 0 ? 'passed' : 'failed'}">Simulation Controls: ${errorCount === 0 ? 'PASSED' : 'FAILED'}</li>
                            <li class="${errorCount === 0 ? 'passed' : 'failed'}">Popup Functionality: ${errorCount === 0 ? 'PASSED' : 'FAILED'}</li>
                        </ul>
                    `;
                }
                
                testSummary.innerHTML = summaryHTML;
            }
        });
    </script>
</body>
</html>